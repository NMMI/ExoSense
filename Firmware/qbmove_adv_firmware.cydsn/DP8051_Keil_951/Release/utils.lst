C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE UTILS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\utils.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\utils.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051_Keil_
                    -951\Release/utils.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\utils.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         utils.h
  37          *
  38          * \brief        Definition of utility functions.
  39          * \date         Dic. 1, 2015
  40          * \author       qbrobotics
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          #include <utils.h>
  46          #include <math.h>
  47          
  48          //==============================================================================
  49          //                                                               CURRENT FILTERS
  50          //==============================================================================
  51          
  52          int32 filter_i1(int32 new_value) {
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 2   

  53   1      
  54   1          static int32 old_value, aux;
  55   1      
  56   1          aux = (old_value * (1024 - ALPHA) + (new_value << 6) * (ALPHA)) >> 10;
  57   1      
  58   1          old_value = aux;
  59   1      
  60   1          return (aux >> 6);
  61   1      }
  62          
  63          int32 filter_i2(int32 new_value) {
  64   1      
  65   1          static int32 old_value, aux;
  66   1      
  67   1          aux = (old_value * (1024 - ALPHA) + (new_value << 6) * (ALPHA)) >> 10;
  68   1      
  69   1          old_value = aux;
  70   1      
  71   1          return (aux >> 6);
  72   1      }
  73          
  74          //==============================================================================
  75          //                                                              VELOCITY FILTERS
  76          //==============================================================================
  77          
  78          int32 filter_vel_1(int32 new_value) {
  79   1      
  80   1          static int32 old_value, aux;
  81   1      
  82   1          aux = (old_value * (1024 - BETA) + (new_value << 6) * (BETA)) / 1024;
  83   1      
  84   1          old_value = aux;
  85   1      
  86   1          return (aux >> 6);
  87   1      }
  88          
  89          int32 filter_vel_2(int32 new_value) {
  90   1      
  91   1          static int32 old_value, aux;
  92   1      
  93   1          aux = (old_value * (1024 - BETA) + (new_value << 6) * (BETA)) / 1024;
  94   1      
  95   1          old_value = aux;
  96   1      
  97   1          return (aux >> 6);
  98   1      }
  99          
 100          int32 filter_vel_3(int32 new_value) {
 101   1      
 102   1          static int32 old_value, aux;
 103   1      
 104   1          aux = (old_value * (1024 - BETA) + (new_value << 6) * (BETA)) / 1024;
 105   1      
 106   1          old_value = aux;
 107   1      
 108   1          return (aux >> 6);
 109   1      }
 110          
 111          
 112          //==============================================================================
 113          //                                                                CHECK ENC DATA
 114          //==============================================================================
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 3   

 115          
 116          // Returns 1 if the encoder data is correct, 0 otherwise
 117          
 118          CYBIT check_enc_data(const uint32 *value) {
 119   1      
 120   1          const uint8* CYIDATA p = (const uint8*)value;
 121   1          uint8 CYDATA a = *p;
 122   1      
 123   1          a = a ^ *(++p);
 124   1          a = a ^ *(++p);
 125   1          a = a ^ *(++p);
 126   1          a = (a & 0x0F) ^ (a>>4);
 127   1      
 128   1          return (0x9669 >> a) & 0x01;
 129   1          //0x9669 is a bit vector representing the !(bitwise XOR) of 4bits
 130   1      }
 131          
 132          
 133          //==============================================================================
 134          //                                                             CHECKSUM FUNCTION
 135          //==============================================================================
 136          
 137          // Performs a XOR byte by byte on the entire vector
 138          
 139          uint8 LCRChecksum(uint8 *data_array, uint8 data_length) {
 140   1          
 141   1          uint8 CYDATA i;
 142   1          uint8 CYDATA checksum = 0x00;
 143   1          
 144   1          for(i = 0; i < data_length; ++i)
 145   1             checksum ^= data_array[i];
 146   1        
 147   1          return checksum;
 148   1      }
 149          //==============================================================================
 150          //                                                                COUNTERS RESET
 151          //==============================================================================
 152          
 153          void reset_counters()
 154          {
 155   1          g_count.activ = 0;
 156   1          g_count.set_inputs = 0;
 157   1          g_count.set_pos_stiff = 0;
 158   1          g_count.get_meas = 0;
 159   1          g_count.get_curr = 0;
 160   1          g_count.get_curr_meas = 0;
 161   1          g_count.get_vel = 0;
 162   1          g_count.get_activ = 0;
 163   1          g_count.get_inputs = 0;
 164   1          g_count.get_info = 0;
 165   1          g_count.set_param = 0;
 166   1          g_count.get_param = 0;
 167   1          g_count.ping = 0;
 168   1          g_count.store_param = 0;
 169   1          g_count.store_default = 0;
 170   1          g_count.restore = 0;
 171   1          g_count.init = 0;
 172   1          g_count.bootloader = 0;
 173   1          g_count.calibrate = 0;
 174   1          g_count.get_counts = 0;
 175   1      }
 176          
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 4   

 177          //==============================================================================
 178          //                                                                  PWM GET SIGN
 179          //==============================================================================
 180          
 181          int8 get_pwm_sign_1(int32 pwm_input)
 182          {
 183   1          static int8 prev_sign;
 184   1          if(pwm_input > 0) {
 185   2              prev_sign = 1;
 186   2              return 1;
 187   2          }
 188   1          else {
 189   2              if(pwm_input < 0) {
 190   3                  prev_sign = -1;
 191   3                  return -1;
 192   3              }
 193   2              else
 194   2                  return prev_sign;
 195   2          }
 196   1      }
 197          
 198          int8 get_pwm_sign_2(int32 pwm_input)
 199          {
 200   1          static int8 prev_sign;
 201   1          if(pwm_input > 0) {
 202   2              prev_sign = 1;
 203   2              return 1;
 204   2          }
 205   1          else {
 206   2              if(pwm_input < 0) {
 207   3                  prev_sign = -1;
 208   3                  return -1;
 209   3              }
 210   2              else
 211   2                  return prev_sign;
 212   2          }
 213   1      }
 214          
 215          /* [] END OF FILE */
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 5   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _filter_i1 (BEGIN)
                                           ; SOURCE LINE # 52
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 56
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B03              MOV     R3,#03H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FFD              MOV     R7,#0FDH
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 780A              MOV     R0,#0AH
0044 120000      E     LCALL   ?C?SLSHR
0047 900000      R     MOV     DPTR,#aux
004A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 58
004D 900000      R     MOV     DPTR,#aux
0050 E0                MOVX    A,@DPTR
0051 FC                MOV     R4,A
0052 A3                INC     DPTR
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 6   

0053 E0                MOVX    A,@DPTR
0054 FD                MOV     R5,A
0055 A3                INC     DPTR
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 900000      R     MOV     DPTR,#old_value
005E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 60
0061 900000      R     MOV     DPTR,#aux
0064 E0                MOVX    A,@DPTR
0065 FC                MOV     R4,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FD                MOV     R5,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FF                MOV     R7,A
006F 7806              MOV     R0,#06H
0071 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 61
0074         ?C0001:
0074 22                RET     
             ; FUNCTION _filter_i1 (END)

             ; FUNCTION _filter_i2 (BEGIN)
                                           ; SOURCE LINE # 63
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 67
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B03              MOV     R3,#03H
0008 FA                MOV     R2,A
0009 F9                MOV     R1,A
000A F8                MOV     R0,A
000B 120000      E     LCALL   ?C?LMUL
000E C004              PUSH    AR4
0010 C005              PUSH    AR5
0012 C006              PUSH    AR6
0014 C007              PUSH    AR7
0016 E4                CLR     A
0017 7FFD              MOV     R7,#0FDH
0019 7E03              MOV     R6,#03H
001B FD                MOV     R5,A
001C FC                MOV     R4,A
001D 900000      R     MOV     DPTR,#old_value
0020 E0                MOVX    A,@DPTR
0021 F8                MOV     R0,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F9                MOV     R1,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 7   

002A FB                MOV     R3,A
002B 120000      E     LCALL   ?C?LMUL
002E D003              POP     AR3
0030 D002              POP     AR2
0032 D001              POP     AR1
0034 D000              POP     AR0
0036 EF                MOV     A,R7
0037 2B                ADD     A,R3
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3A                ADDC    A,R2
003B FE                MOV     R6,A
003C ED                MOV     A,R5
003D 39                ADDC    A,R1
003E FD                MOV     R5,A
003F EC                MOV     A,R4
0040 38                ADDC    A,R0
0041 FC                MOV     R4,A
0042 780A              MOV     R0,#0AH
0044 120000      E     LCALL   ?C?SLSHR
0047 900000      R     MOV     DPTR,#aux
004A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 69
004D 900000      R     MOV     DPTR,#aux
0050 E0                MOVX    A,@DPTR
0051 FC                MOV     R4,A
0052 A3                INC     DPTR
0053 E0                MOVX    A,@DPTR
0054 FD                MOV     R5,A
0055 A3                INC     DPTR
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 900000      R     MOV     DPTR,#old_value
005E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 71
0061 900000      R     MOV     DPTR,#aux
0064 E0                MOVX    A,@DPTR
0065 FC                MOV     R4,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FD                MOV     R5,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FF                MOV     R7,A
006F 7806              MOV     R0,#06H
0071 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 72
0074         ?C0002:
0074 22                RET     
             ; FUNCTION _filter_i2 (END)

             ; FUNCTION _filter_vel_1 (BEGIN)
                                           ; SOURCE LINE # 78
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 82
0000 7806              MOV     R0,#06H
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 8   

0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B2C              MOV     R3,#02CH
0008 7A01              MOV     R2,#01H
000A F9                MOV     R1,A
000B F8                MOV     R0,A
000C 120000      E     LCALL   ?C?LMUL
000F C004              PUSH    AR4
0011 C005              PUSH    AR5
0013 C006              PUSH    AR6
0015 C007              PUSH    AR7
0017 E4                CLR     A
0018 7FD4              MOV     R7,#0D4H
001A 7E02              MOV     R6,#02H
001C FD                MOV     R5,A
001D FC                MOV     R4,A
001E 900000      R     MOV     DPTR,#old_value
0021 E0                MOVX    A,@DPTR
0022 F8                MOV     R0,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 F9                MOV     R1,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FA                MOV     R2,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B FB                MOV     R3,A
002C 120000      E     LCALL   ?C?LMUL
002F D003              POP     AR3
0031 D002              POP     AR2
0033 D001              POP     AR1
0035 D000              POP     AR0
0037 EF                MOV     A,R7
0038 2B                ADD     A,R3
0039 FF                MOV     R7,A
003A EE                MOV     A,R6
003B 3A                ADDC    A,R2
003C FE                MOV     R6,A
003D ED                MOV     A,R5
003E 39                ADDC    A,R1
003F FD                MOV     R5,A
0040 EC                MOV     A,R4
0041 38                ADDC    A,R0
0042 FC                MOV     R4,A
0043 E4                CLR     A
0044 FB                MOV     R3,A
0045 7A04              MOV     R2,#04H
0047 F9                MOV     R1,A
0048 F8                MOV     R0,A
0049 120000      E     LCALL   ?C?SLDIV
004C 900000      R     MOV     DPTR,#aux
004F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 84
0052 900000      R     MOV     DPTR,#aux
0055 E0                MOVX    A,@DPTR
0056 FC                MOV     R4,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FD                MOV     R5,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 9   

005C FE                MOV     R6,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FF                MOV     R7,A
0060 900000      R     MOV     DPTR,#old_value
0063 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 86
0066 900000      R     MOV     DPTR,#aux
0069 E0                MOVX    A,@DPTR
006A FC                MOV     R4,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FD                MOV     R5,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FE                MOV     R6,A
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 FF                MOV     R7,A
0074 7806              MOV     R0,#06H
0076 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 87
0079         ?C0003:
0079 22                RET     
             ; FUNCTION _filter_vel_1 (END)

             ; FUNCTION _filter_vel_2 (BEGIN)
                                           ; SOURCE LINE # 89
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 93
0000 7806              MOV     R0,#06H
0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B2C              MOV     R3,#02CH
0008 7A01              MOV     R2,#01H
000A F9                MOV     R1,A
000B F8                MOV     R0,A
000C 120000      E     LCALL   ?C?LMUL
000F C004              PUSH    AR4
0011 C005              PUSH    AR5
0013 C006              PUSH    AR6
0015 C007              PUSH    AR7
0017 E4                CLR     A
0018 7FD4              MOV     R7,#0D4H
001A 7E02              MOV     R6,#02H
001C FD                MOV     R5,A
001D FC                MOV     R4,A
001E 900000      R     MOV     DPTR,#old_value
0021 E0                MOVX    A,@DPTR
0022 F8                MOV     R0,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 F9                MOV     R1,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FA                MOV     R2,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B FB                MOV     R3,A
002C 120000      E     LCALL   ?C?LMUL
002F D003              POP     AR3
0031 D002              POP     AR2
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 10  

0033 D001              POP     AR1
0035 D000              POP     AR0
0037 EF                MOV     A,R7
0038 2B                ADD     A,R3
0039 FF                MOV     R7,A
003A EE                MOV     A,R6
003B 3A                ADDC    A,R2
003C FE                MOV     R6,A
003D ED                MOV     A,R5
003E 39                ADDC    A,R1
003F FD                MOV     R5,A
0040 EC                MOV     A,R4
0041 38                ADDC    A,R0
0042 FC                MOV     R4,A
0043 E4                CLR     A
0044 FB                MOV     R3,A
0045 7A04              MOV     R2,#04H
0047 F9                MOV     R1,A
0048 F8                MOV     R0,A
0049 120000      E     LCALL   ?C?SLDIV
004C 900000      R     MOV     DPTR,#aux
004F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 95
0052 900000      R     MOV     DPTR,#aux
0055 E0                MOVX    A,@DPTR
0056 FC                MOV     R4,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FD                MOV     R5,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FE                MOV     R6,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FF                MOV     R7,A
0060 900000      R     MOV     DPTR,#old_value
0063 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 97
0066 900000      R     MOV     DPTR,#aux
0069 E0                MOVX    A,@DPTR
006A FC                MOV     R4,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FD                MOV     R5,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FE                MOV     R6,A
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 FF                MOV     R7,A
0074 7806              MOV     R0,#06H
0076 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 98
0079         ?C0004:
0079 22                RET     
             ; FUNCTION _filter_vel_2 (END)

             ; FUNCTION _filter_vel_3 (BEGIN)
                                           ; SOURCE LINE # 100
;---- Variable 'new_value' assigned to Register 'R4/R5/R6/R7' ----
                                           ; SOURCE LINE # 104
0000 7806              MOV     R0,#06H
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 11  

0002 120000      E     LCALL   ?C?LSHL
0005 E4                CLR     A
0006 7B2C              MOV     R3,#02CH
0008 7A01              MOV     R2,#01H
000A F9                MOV     R1,A
000B F8                MOV     R0,A
000C 120000      E     LCALL   ?C?LMUL
000F C004              PUSH    AR4
0011 C005              PUSH    AR5
0013 C006              PUSH    AR6
0015 C007              PUSH    AR7
0017 E4                CLR     A
0018 7FD4              MOV     R7,#0D4H
001A 7E02              MOV     R6,#02H
001C FD                MOV     R5,A
001D FC                MOV     R4,A
001E 900000      R     MOV     DPTR,#old_value
0021 E0                MOVX    A,@DPTR
0022 F8                MOV     R0,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 F9                MOV     R1,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FA                MOV     R2,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B FB                MOV     R3,A
002C 120000      E     LCALL   ?C?LMUL
002F D003              POP     AR3
0031 D002              POP     AR2
0033 D001              POP     AR1
0035 D000              POP     AR0
0037 EF                MOV     A,R7
0038 2B                ADD     A,R3
0039 FF                MOV     R7,A
003A EE                MOV     A,R6
003B 3A                ADDC    A,R2
003C FE                MOV     R6,A
003D ED                MOV     A,R5
003E 39                ADDC    A,R1
003F FD                MOV     R5,A
0040 EC                MOV     A,R4
0041 38                ADDC    A,R0
0042 FC                MOV     R4,A
0043 E4                CLR     A
0044 FB                MOV     R3,A
0045 7A04              MOV     R2,#04H
0047 F9                MOV     R1,A
0048 F8                MOV     R0,A
0049 120000      E     LCALL   ?C?SLDIV
004C 900000      R     MOV     DPTR,#aux
004F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 106
0052 900000      R     MOV     DPTR,#aux
0055 E0                MOVX    A,@DPTR
0056 FC                MOV     R4,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FD                MOV     R5,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 12  

005C FE                MOV     R6,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FF                MOV     R7,A
0060 900000      R     MOV     DPTR,#old_value
0063 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 108
0066 900000      R     MOV     DPTR,#aux
0069 E0                MOVX    A,@DPTR
006A FC                MOV     R4,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FD                MOV     R5,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FE                MOV     R6,A
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 FF                MOV     R7,A
0074 7806              MOV     R0,#06H
0076 120000      E     LCALL   ?C?SLSHR
                                           ; SOURCE LINE # 109
0079         ?C0005:
0079 22                RET     
             ; FUNCTION _filter_vel_3 (END)

             ; FUNCTION _check_enc_data (BEGIN)
                                           ; SOURCE LINE # 118
;---- Variable 'value' assigned to Register 'R1/R2/R3' ----
                                           ; SOURCE LINE # 120
0000 7800        R     MOV     R0,#LOW p
0002 A603              MOV     @R0,AR3
0004 08                INC     R0
0005 A602              MOV     @R0,AR2
0007 08                INC     R0
0008 A601              MOV     @R0,AR1
                                           ; SOURCE LINE # 121
000A 120000      E     LCALL   ?C?CLDPTR
000D F500        R     MOV     a,A
                                           ; SOURCE LINE # 123
000F 7800        R     MOV     R0,#LOW p
0011 8603              MOV     AR3,@R0
0013 08                INC     R0
0014 08                INC     R0
0015 06                INC     @R0
0016 E6                MOV     A,@R0
0017 18                DEC     R0
0018 7001              JNZ     ?C0022
001A 06                INC     @R0
001B         ?C0022:
001B F9                MOV     R1,A
001C 8602              MOV     AR2,@R0
001E 120000      E     LCALL   ?C?CLDPTR
0021 6200        R     XRL     a,A
                                           ; SOURCE LINE # 124
0023 7800        R     MOV     R0,#LOW p
0025 8603              MOV     AR3,@R0
0027 08                INC     R0
0028 08                INC     R0
0029 06                INC     @R0
002A E6                MOV     A,@R0
002B 18                DEC     R0
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 13  

002C 7001              JNZ     ?C0023
002E 06                INC     @R0
002F         ?C0023:
002F F9                MOV     R1,A
0030 8602              MOV     AR2,@R0
0032 120000      E     LCALL   ?C?CLDPTR
0035 6200        R     XRL     a,A
                                           ; SOURCE LINE # 125
0037 7800        R     MOV     R0,#LOW p
0039 8603              MOV     AR3,@R0
003B 08                INC     R0
003C 08                INC     R0
003D 06                INC     @R0
003E E6                MOV     A,@R0
003F 18                DEC     R0
0040 7001              JNZ     ?C0024
0042 06                INC     @R0
0043         ?C0024:
0043 F9                MOV     R1,A
0044 8602              MOV     AR2,@R0
0046 120000      E     LCALL   ?C?CLDPTR
0049 6200        R     XRL     a,A
                                           ; SOURCE LINE # 126
004B E500        R     MOV     A,a
004D C4                SWAP    A
004E 540F              ANL     A,#0FH
0050 FF                MOV     R7,A
0051 E500        R     MOV     A,a
0053 540F              ANL     A,#0FH
0055 6F                XRL     A,R7
0056 F500        R     MOV     a,A
                                           ; SOURCE LINE # 128
0058 FF                MOV     R7,A
0059 7469              MOV     A,#069H
005B 7E96              MOV     R6,#096H
005D A807              MOV     R0,AR7
005F 08                INC     R0
0060 8005              SJMP    ?C0026
0062         ?C0025:
0062 CE                XCH     A,R6
0063 C3                CLR     C
0064 13                RRC     A
0065 CE                XCH     A,R6
0066 13                RRC     A
0067         ?C0026:
0067 D8F9              DJNZ    R0,?C0025
0069 13                RRC     A
                                           ; SOURCE LINE # 130
006A         ?C0006:
006A 22                RET     
             ; FUNCTION _check_enc_data (END)

             ; FUNCTION _LCRChecksum (BEGIN)
                                           ; SOURCE LINE # 139
0000 900000      R     MOV     DPTR,#data_array
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 14  

000A F0                MOVX    @DPTR,A
;---- Variable 'data_length' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 142
000B E4                CLR     A
000C F500        R     MOV     checksum,A
                                           ; SOURCE LINE # 144
000E F500        R     MOV     i,A
0010         ?C0007:
0010 E500        R     MOV     A,i
0012 C3                CLR     C
0013 9D                SUBB    A,R5
0014 5019              JNC     ?C0008
                                           ; SOURCE LINE # 145
0016 900000      R     MOV     DPTR,#data_array
0019 E0                MOVX    A,@DPTR
001A FB                MOV     R3,A
001B A3                INC     DPTR
001C E0                MOVX    A,@DPTR
001D FA                MOV     R2,A
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 2500        R     ADD     A,i
0022 F9                MOV     R1,A
0023 E4                CLR     A
0024 3A                ADDC    A,R2
0025 FA                MOV     R2,A
0026 120000      E     LCALL   ?C?CLDPTR
0029 6200        R     XRL     checksum,A
002B 0500        R     INC     i
002D 80E1              SJMP    ?C0007
002F         ?C0008:
                                           ; SOURCE LINE # 147
002F AF00        R     MOV     R7,checksum
                                           ; SOURCE LINE # 148
0031         ?C0010:
0031 22                RET     
             ; FUNCTION _LCRChecksum (END)

             ; FUNCTION reset_counters (BEGIN)
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 155
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#g_count
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 156
0007 A3                INC     DPTR
0008 F0                MOVX    @DPTR,A
0009 A3                INC     DPTR
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 157
000B A3                INC     DPTR
000C F0                MOVX    @DPTR,A
000D A3                INC     DPTR
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
000F A3                INC     DPTR
0010 F0                MOVX    @DPTR,A
0011 A3                INC     DPTR
0012 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 15  

                                           ; SOURCE LINE # 159
0013 A3                INC     DPTR
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
0017 A3                INC     DPTR
0018 F0                MOVX    @DPTR,A
0019 A3                INC     DPTR
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 161
001B A3                INC     DPTR
001C F0                MOVX    @DPTR,A
001D A3                INC     DPTR
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 162
001F A3                INC     DPTR
0020 F0                MOVX    @DPTR,A
0021 A3                INC     DPTR
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 163
0023 A3                INC     DPTR
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 164
0027 A3                INC     DPTR
0028 F0                MOVX    @DPTR,A
0029 A3                INC     DPTR
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 165
002B A3                INC     DPTR
002C F0                MOVX    @DPTR,A
002D A3                INC     DPTR
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 166
002F A3                INC     DPTR
0030 F0                MOVX    @DPTR,A
0031 A3                INC     DPTR
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 167
0033 A3                INC     DPTR
0034 F0                MOVX    @DPTR,A
0035 A3                INC     DPTR
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 168
0037 A3                INC     DPTR
0038 F0                MOVX    @DPTR,A
0039 A3                INC     DPTR
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 169
003B A3                INC     DPTR
003C F0                MOVX    @DPTR,A
003D A3                INC     DPTR
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 170
003F A3                INC     DPTR
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 171
0043 A3                INC     DPTR
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 16  

0044 F0                MOVX    @DPTR,A
0045 A3                INC     DPTR
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 172
0047 A3                INC     DPTR
0048 F0                MOVX    @DPTR,A
0049 A3                INC     DPTR
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 173
004B A3                INC     DPTR
004C F0                MOVX    @DPTR,A
004D A3                INC     DPTR
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 174
004F A3                INC     DPTR
0050 F0                MOVX    @DPTR,A
0051 A3                INC     DPTR
0052 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0053 22                RET     
             ; FUNCTION reset_counters (END)

             ; FUNCTION _get_pwm_sign_1 (BEGIN)
                                           ; SOURCE LINE # 181
0000 900000      R     MOV     DPTR,#pwm_input
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 184
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008 FE                MOV     R6,A
0009 FD                MOV     R5,A
000A FC                MOV     R4,A
000B 900000      R     MOV     DPTR,#pwm_input
000E E0                MOVX    A,@DPTR
000F F8                MOV     R0,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 F9                MOV     R1,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FA                MOV     R2,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FB                MOV     R3,A
0019 D3                SETB    C
001A 120000      E     LCALL   ?C?SLCMP
001D 4008              JC      ?C0012
                                           ; SOURCE LINE # 185
001F 900000      R     MOV     DPTR,#prev_sign
0022 7401              MOV     A,#01H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 186
0025 FF                MOV     R7,A
0026 22                RET     
                                           ; SOURCE LINE # 187
0027         ?C0012:
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 189
0027 E4                CLR     A
0028 FF                MOV     R7,A
0029 FE                MOV     R6,A
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 17  

002A FD                MOV     R5,A
002B FC                MOV     R4,A
002C 900000      R     MOV     DPTR,#pwm_input
002F E0                MOVX    A,@DPTR
0030 F8                MOV     R0,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 F9                MOV     R1,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FA                MOV     R2,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FB                MOV     R3,A
003A C3                CLR     C
003B 120000      E     LCALL   ?C?SLCMP
003E 5008              JNC     ?C0015
                                           ; SOURCE LINE # 190
0040 900000      R     MOV     DPTR,#prev_sign
0043 74FF              MOV     A,#0FFH
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 191
0046 FF                MOV     R7,A
0047 22                RET     
                                           ; SOURCE LINE # 192
0048         ?C0015:
                                           ; SOURCE LINE # 194
0048 900000      R     MOV     DPTR,#prev_sign
004B E0                MOVX    A,@DPTR
004C FF                MOV     R7,A
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
004D         ?C0013:
004D 22                RET     
             ; FUNCTION _get_pwm_sign_1 (END)

             ; FUNCTION _get_pwm_sign_2 (BEGIN)
                                           ; SOURCE LINE # 198
0000 900000      R     MOV     DPTR,#pwm_input
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 201
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008 FE                MOV     R6,A
0009 FD                MOV     R5,A
000A FC                MOV     R4,A
000B 900000      R     MOV     DPTR,#pwm_input
000E E0                MOVX    A,@DPTR
000F F8                MOV     R0,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 F9                MOV     R1,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FA                MOV     R2,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FB                MOV     R3,A
0019 D3                SETB    C
001A 120000      E     LCALL   ?C?SLCMP
001D 4008              JC      ?C0017
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 18  

                                           ; SOURCE LINE # 202
001F 900000      R     MOV     DPTR,#prev_sign
0022 7401              MOV     A,#01H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 203
0025 FF                MOV     R7,A
0026 22                RET     
                                           ; SOURCE LINE # 204
0027         ?C0017:
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 206
0027 E4                CLR     A
0028 FF                MOV     R7,A
0029 FE                MOV     R6,A
002A FD                MOV     R5,A
002B FC                MOV     R4,A
002C 900000      R     MOV     DPTR,#pwm_input
002F E0                MOVX    A,@DPTR
0030 F8                MOV     R0,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 F9                MOV     R1,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FA                MOV     R2,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FB                MOV     R3,A
003A C3                CLR     C
003B 120000      E     LCALL   ?C?SLCMP
003E 5008              JNC     ?C0020
                                           ; SOURCE LINE # 207
0040 900000      R     MOV     DPTR,#prev_sign
0043 74FF              MOV     A,#0FFH
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 208
0046 FF                MOV     R7,A
0047 22                RET     
                                           ; SOURCE LINE # 209
0048         ?C0020:
                                           ; SOURCE LINE # 211
0048 900000      R     MOV     DPTR,#prev_sign
004B E0                MOVX    A,@DPTR
004C FF                MOV     R7,A
                                           ; SOURCE LINE # 212
                                           ; SOURCE LINE # 213
004D         ?C0018:
004D 22                RET     
             ; FUNCTION _get_pwm_sign_2 (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    997    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     42      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----       3
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
C51 COMPILER V9.51   UTILS                                                                 03/22/2017 09:03:57 PAGE 19  

   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
